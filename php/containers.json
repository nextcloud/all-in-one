{
  "services": [
    {
      "container_name": "nextcloud-aio-apache",
      "depends_on": [
        "nextcloud-aio-onlyoffice",
        "nextcloud-aio-collabora",
        "nextcloud-aio-talk",
        "nextcloud-aio-nextcloud"
      ],
      "display_name": "Apache",
      "image": "nextcloud/aio-apache",
      "ports": [
        {
          "port": "%APACHE_PORT%",
          "ip_binding": "%APACHE_IP_BINDING%",
          "protocol": "tcp"
        }
      ],
      "internal_port": "%APACHE_PORT%",
      "secrets": [],
      "environment": [
        "NC_DOMAIN=%NC_DOMAIN%",
        "NEXTCLOUD_HOST=nextcloud-aio-nextcloud",
        "COLLABORA_HOST=nextcloud-aio-collabora",
        "TALK_HOST=nextcloud-aio-talk",
        "APACHE_PORT=%APACHE_PORT%",
        "ONLYOFFICE_HOST=nextcloud-aio-onlyoffice",
        "TZ=%TIMEZONE%",
        "APACHE_MAX_SIZE=%APACHE_MAX_SIZE%",
        "APACHE_MAX_TIME=%NEXTCLOUD_MAX_TIME%"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_nextcloud",
          "location": "/var/www/html",
          "writeable": false
        },
        {
          "name": "nextcloud_aio_apache",
          "location": "/mnt/data",
          "writeable": true
        }
      ],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-database",
      "depends_on": [],
      "display_name": "Database",
      "image": "nextcloud/aio-postgresql",
      "ports": [],
      "internal_port": "5432",
      "secrets": [
        "DATABASE_PASSWORD"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_database",
          "location": "/var/lib/postgresql/data",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_database_dump",
          "location": "/mnt/data",
          "writeable": true
        }
      ],
      "environment": [
        "POSTGRES_PASSWORD=%DATABASE_PASSWORD%",
        "POSTGRES_DB=nextcloud_database",
        "POSTGRES_USER=nextcloud",
        "TZ=%TIMEZONE%",
        "PGTZ=%TIMEZONE%"
      ],
      "stop_grace_period": 1800,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-nextcloud",
      "depends_on": [
        "nextcloud-aio-database",
        "nextcloud-aio-redis",
        "nextcloud-aio-clamav",
        "nextcloud-aio-fulltextsearch",
        "nextcloud-aio-imaginary"
      ],
      "display_name": "Nextcloud",
      "image": "nextcloud/aio-nextcloud",
      "ports": [],
      "internal_port": "9000",
      "secrets": [
        "DATABASE_PASSWORD",
        "REDIS_PASSWORD",
        "NEXTCLOUD_PASSWORD",
        "TURN_SECRET",
        "SIGNALING_SECRET"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_nextcloud",
          "location": "/var/www/html",
          "writeable": true
        },
        {
          "name": "%NEXTCLOUD_DATADIR%",
          "location": "/mnt/ncdata",
          "writeable": true
        },
        {
          "name": "%NEXTCLOUD_MOUNT%",
          "location": "%NEXTCLOUD_MOUNT%",
          "writeable": true
        },
        {
          "name": "%NEXTCLOUD_TRUSTED_CACERTS_DIR%",
          "location": "/usr/local/share/ca-certificates",
          "writeable": false
        }
      ],
      "environment": [
        "POSTGRES_HOST=nextcloud-aio-database",
        "POSTGRES_PASSWORD=%DATABASE_PASSWORD%",
        "POSTGRES_DB=nextcloud_database",
        "POSTGRES_USER=nextcloud",
        "REDIS_HOST=nextcloud-aio-redis",
        "REDIS_HOST_PASSWORD=%REDIS_PASSWORD%",
        "AIO_TOKEN=%AIO_TOKEN%",
        "NC_DOMAIN=%NC_DOMAIN%",
        "ADMIN_USER=admin",
        "ADMIN_PASSWORD=%NEXTCLOUD_PASSWORD%",
        "NEXTCLOUD_DATA_DIR=/mnt/ncdata",
        "OVERWRITEHOST=%NC_DOMAIN%",
        "OVERWRITEPROTOCOL=https",
        "TURN_SECRET=%TURN_SECRET%",
        "SIGNALING_SECRET=%SIGNALING_SECRET%",
        "ONLYOFFICE_SECRET=%ONLYOFFICE_SECRET%",
        "AIO_URL=%AIO_URL%",
        "NEXTCLOUD_MOUNT=%NEXTCLOUD_MOUNT%",
        "CLAMAV_ENABLED=%CLAMAV_ENABLED%",
        "CLAMAV_HOST=nextcloud-aio-clamav",
        "ONLYOFFICE_ENABLED=%ONLYOFFICE_ENABLED%",
        "COLLABORA_ENABLED=%COLLABORA_ENABLED%",
        "COLLABORA_HOST=nextcloud-aio-collabora",
        "TALK_ENABLED=%TALK_ENABLED%",
        "ONLYOFFICE_HOST=nextcloud-aio-onlyoffice",
        "UPDATE_NEXTCLOUD_APPS=%UPDATE_NEXTCLOUD_APPS%",
        "TZ=%TIMEZONE%",
        "TALK_PORT=%TALK_PORT%",
        "IMAGINARY_ENABLED=%IMAGINARY_ENABLED%",
        "IMAGINARY_HOST=nextcloud-aio-imaginary",
        "PHP_UPLOAD_LIMIT=%NEXTCLOUD_UPLOAD_LIMIT%",
        "PHP_MEMORY_LIMIT=%NEXTCLOUD_MEMORY_LIMIT%",
        "FULLTEXTSEARCH_ENABLED=%FULLTEXTSEARCH_ENABLED%",
        "FULLTEXTSEARCH_HOST=nextcloud-aio-fulltextsearch",
        "PHP_MAX_TIME=%NEXTCLOUD_MAX_TIME%",
        "TRUSTED_CACERTS_DIR=%NEXTCLOUD_TRUSTED_CACERTS_DIR%",
        "STARTUP_APPS=%NEXTCLOUD_STARTUP_APPS%",
        "ADDITIONAL_APKS=%NEXTCLOUD_ADDITIONAL_APKS%",
        "ADDITIONAL_PHP_EXTENSIONS=%NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS%"
      ],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-redis",
      "depends_on": [],
      "display_name": "Redis",
      "image": "nextcloud/aio-redis",
      "ports": [],
      "internal_port": "6379",
      "environment": [
        "REDIS_HOST_PASSWORD=%REDIS_PASSWORD%",
        "TZ=%TIMEZONE%"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_redis",
          "location": "/data",
          "writeable": true
        }
      ],
      "secrets": [
        "REDIS_PASSWORD",
        "ONLYOFFICE_SECRET"
      ],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-collabora",
      "depends_on": [],
      "display_name": "Collabora",
      "image": "nextcloud/aio-collabora",
      "ports": [],
      "internal_port": "9980",
      "environment": [
        "aliasgroup1=https://%NC_DOMAIN%:443",
        "extra_params=--o:ssl.enable=false --o:ssl.termination=true --o:logging.level=warning --o:home_mode.enable=true %COLLABORA_SECCOMP_POLICY%",
        "dictionaries=%COLLABORA_DICTIONARIES%",
        "TZ=%TIMEZONE%"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_collabora_fonts",
          "location": "/opt/cool/systemplate/tmpfonts",
          "writeable": true
        }
      ],
      "secrets": [],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-talk",
      "depends_on": [],
      "display_name": "Talk",
      "image": "nextcloud/aio-talk",
      "ports": [
        {
          "port": "%TALK_PORT%",
          "ip_binding": "",
          "protocol": "tcp"
        },
        {
          "port": "%TALK_PORT%",
          "ip_binding": "",
          "protocol": "udp"
        }
      ],
      "internal_port": "%TALK_PORT%",
      "environment": [
        "NC_DOMAIN=%NC_DOMAIN%",
        "TURN_SECRET=%TURN_SECRET%",
        "SIGNALING_SECRET=%SIGNALING_SECRET%",
        "JANUS_API_KEY=%JANUS_API_KEY%",
        "TZ=%TIMEZONE%",
        "TALK_PORT=%TALK_PORT%"
      ],
      "volumes": [],
      "secrets": [
        "TURN_SECRET",
        "SIGNALING_SECRET",
        "JANUS_API_KEY"
      ],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-borgbackup",
      "depends_on": [],
      "display_name": "Borgbackup",
      "image": "nextcloud/aio-borgbackup",
      "ports": [],
      "internal_port": "",
      "environment": [
        "BORG_PASSWORD=%BORGBACKUP_PASSWORD%",
        "BORG_MODE=%BORGBACKUP_MODE%",
        "SELECTED_RESTORE_TIME=%SELECTED_RESTORE_TIME%",
        "BACKUP_RESTORE_PASSWORD=%BACKUP_RESTORE_PASSWORD%",
        "ADDITIONAL_DIRECTORIES_BACKUP=%ADDITIONAL_DIRECTORIES_BACKUP%",
        "BORGBACKUP_HOST_LOCATION=%BORGBACKUP_HOST_LOCATION%"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_backup_cache",
          "location": "/root",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_nextcloud",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_nextcloud",
          "writeable": true
        },
        {
          "name": "%NEXTCLOUD_DATADIR%",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_nextcloud_data",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_database",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_database",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_database_dump",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_database_dump",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_apache",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_apache",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_mastercontainer",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_mastercontainer",
          "writeable": true
        },
        {
          "name": "%BORGBACKUP_HOST_LOCATION%",
          "location": "/mnt/borgbackup",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_elasticsearch",
          "location": "/nextcloud_aio_volumes/nextcloud_aio_elasticsearch",
          "writeable": true
        },
        {
          "name": "nextcloud_aio_redis",
          "location": "/mnt/redis",
          "writeable": true
        }
      ],
      "secrets": [
        "BORGBACKUP_PASSWORD"
      ],
      "stop_grace_period": 10,
      "restart": ""
    },
    {
      "container_name": "nextcloud-aio-watchtower",
      "depends_on": [],
      "display_name": "Watchtower",
      "image": "nextcloud/aio-watchtower",
      "ports": [],
      "internal_port": "",
      "environment": [
        "CONTAINER_TO_UPDATE=nextcloud-aio-mastercontainer"
      ],
      "volumes": [
        {
          "name": "%DOCKER_SOCKET_PATH%",
          "location": "/var/run/docker.sock",
          "writeable": false
        }
      ],
      "secrets": [],
      "stop_grace_period": 10,
      "restart": ""
    },
    {
      "depends_on": [],
      "container_name": "nextcloud-aio-domaincheck",
      "display_name": "Domaincheck",
      "image": "nextcloud/aio-domaincheck",
      "ports": [
        {
          "port": "%APACHE_PORT%",
          "ip_binding": "%APACHE_IP_BINDING%",
          "protocol": "tcp"
        }
      ],
      "internal_port": "",
      "environment": [
        "INSTANCE_ID=%INSTANCE_ID%",
        "APACHE_PORT=%APACHE_PORT%"
      ],
      "volumes": [],
      "secrets": [
        "INSTANCE_ID"
      ],
      "stop_grace_period": 1,
      "restart": ""
    },
    {
      "container_name": "nextcloud-aio-clamav",
      "depends_on": [],
      "display_name": "ClamAV",
      "image": "nextcloud/aio-clamav",
      "ports": [],
      "internal_port": "3310",
      "environment": [
        "TZ=%TIMEZONE%",
        "CLAMD_STARTUP_TIMEOUT=90"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_clamav",
          "location": "/var/lib/clamav",
          "writeable": true
        }
      ],
      "secrets": [],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-onlyoffice",
      "depends_on": [],
      "display_name": "OnlyOffice",
      "image": "nextcloud/aio-onlyoffice",
      "ports": [],
      "internal_port": "80",
      "environment": [
        "TZ=%TIMEZONE%",
        "JWT_ENABLED=true",
        "JWT_HEADER=AuthorizationJwt",
        "JWT_SECRET=%ONLYOFFICE_SECRET%"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_onlyoffice",
          "location": "/var/lib/onlyoffice",
          "writeable": true
        }
      ],
      "secrets": [
        "ONLYOFFICE_SECRET"
      ],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-imaginary",
      "depends_on": [],
      "display_name": "Imaginary",
      "image": "nextcloud/aio-imaginary",
      "ports": [],
      "internal_port": "9000",
      "environment": [
        "TZ=%TIMEZONE%"
      ],
      "volumes": [],
      "secrets": [],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    },
    {
      "container_name": "nextcloud-aio-fulltextsearch",
      "depends_on": [],
      "display_name": "Fulltextsearch",
      "image": "nextcloud/aio-fulltextsearch",
      "ports": [],
      "internal_port": "9200",
      "environment": [
        "TZ=%TIMEZONE%",
        "discovery.type=single-node",
        "ES_JAVA_OPTS=-Xms1024M -Xmx1024M"
      ],
      "volumes": [
        {
          "name": "nextcloud_aio_elasticsearch",
          "location": "/usr/share/elasticsearch/data",
          "writeable": true
        }
      ],
      "secrets": [],
      "stop_grace_period": 10,
      "restart": "unless-stopped"
    }
  ]
}
